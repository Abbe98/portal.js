server {
  listen 443 ssl http2;
  server_name  localhost;
  ssl_certificate /etc/nginx/ssl/server.crt;
  ssl_certificate_key /etc/nginx/ssl/server.key;

  proxy_cache apis;

  resolver 8.8.8.8 ipv6=off;

  location / {
    root   /usr/share/nginx/html;
    index  index.html;

    # Wide-open CORS
    # From: https://enable-cors.org/server_nginx.html
    # if ($request_method = 'OPTIONS') {
    #   add_header 'Access-Control-Allow-Origin' '*';
    #   add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    #   #
    #   # Custom headers and headers various browsers *should* be OK with but aren't
    #   #
    #   add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    #   #
    #   # Tell client that this pre-flight info is valid for 20 days
    #   #
    #   add_header 'Access-Control-Max-Age' 1728000;
    #   add_header 'Content-Type' 'text/plain; charset=utf-8';
    #   add_header 'Content-Length' 0;
    #   return 204;
    # }
    # if ($request_method = 'POST') {
    #   add_header 'Access-Control-Allow-Origin' '*';
    #   add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    #   add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    #   add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
    # }
    # if ($request_method = 'GET') {
    #   add_header 'Access-Control-Allow-Origin' '*';
    #   add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
    #   add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
    #   add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';
    # }
  }

  # APIs
  location ~ ^/(api/v2|entity|record)/ {
    proxy_set_header Host api.europeana.eu;
    proxy_pass https://api.europeana.eu$uri$is_args$args;
  }
  location ~ ^/newspaper/(.*) {
    proxy_set_header Host newspapers.eanadev.org;
    proxy_pass https://newspapers.eanadev.org/$1$is_args$args;
  }
  # TODO: also Contentful assets? would need to rewrite all asset URLs somwhere though...
  location ~ ^/contentful/(.*) {
    proxy_set_header Host cdn.contentful.com;
    proxy_pass https://cdn.contentful.com/$1$is_args$args;
  }


}
